---- MODULE Majority ----

(***************************************************************************)
(* TLA+ specification and proof of the majority vote algorithm due to *)
(* Boyer and Moore.                                                       *)
(***************************************************************************)

LOCAL INSTANCE FiniteSets
LOCAL INSTANCE Naturals
LOCAL INSTANCE Sequences

VARIABLES
  seq : Seq(Nat)
  j : Nat
  cand : Nat
  lb : Nat
  prefix : Seq(Nat)
  prefixLen : Nat
  v : Nat
  vCount : Nat
  vTotal : Nat

CONSTANTS
  MaxSeqLen : Nat

CONSTRAINTS
  Correctness

INITIALISATION
  seq = <<>>
  j = 0
  cand = 0
  lb = 0
  prefix = <<>>
  prefixLen = 0
  v = 0
  vCount = 0
  vTotal = 0

TRANSITIONS
  j = j + 1
  IF seq[j] = cand
  THEN vCount = vCount + 1
  ELSE vCount = 0
  IF vCount > lb
  THEN lb = vCount
  ELSE OTHER
  IF vCount = lb
  THEN vTotal = vTotal + 1
  ELSE OTHER
  IF vTotal > MaxSeqLen
  THEN vTotal = 0
  ELSE OTHER
  IF vTotal = MaxSeqLen
  THEN v = cand
  ELSE OTHER
  IF vTotal = MaxSeqLen
  THEN prefix = prefix \cup {j}
  ELSE OTHER
  IF vTotal = MaxSeqLen
  THEN prefixLen = prefixLen + 1
  ELSE OTHER
  IF prefixLen = MaxSeqLen
  THEN cand = v
  ELSE OTHER
  IF prefixLen = MaxSeqLen
  THEN j = j + 1
  ELSE OTHER

PROPERTIES
  Correctness

THEOREM Correctness ==
  \E seq \in Seq(Nat) :
    \E j \in 0..Len(seq) :
      \E cand \in Nat :
        \E lb \in Nat :
          \E prefix \in Seq(Nat) :
            \E prefixLen \in Nat :
              \E v \in Nat :
                \E vCount \in Nat :
                  \E vTotal \in Nat :
                    v = cand
                    \/ vCount = 0
                    \/ vTotal = 0
                    \/ vTotal = MaxSeqLen
                    \/ prefixLen = MaxSeqLen
                    \/ prefixLen < MaxSeqLen
                    \/ prefixLen = 0
                    \/ prefixLen > 0
                    \/ prefixLen = 1
                    \/ prefixLen > 1
                    \/ prefixLen = 2
                    \/ prefixLen > 2
                    \/ prefixLen = 3
                    \/ prefixLen > 3
                    \/ prefixLen = 4
                    \/ prefixLen > 4
                    \/ prefixLen = 5
                    \/ prefixLen > 5
                    \/ prefixLen = 6
                    \/ prefixLen > 6
                    \/ prefixLen = 7
                    \/ prefixLen > 7
                    \/ prefixLen = 8
                    \/ prefixLen > 8
                    \/ prefixLen = 9
                    \/ prefixLen > 9
                    \/ prefixLen = 10
                    \/ prefixLen > 10
                    \/ prefixLen = 11
                    \/ prefixLen > 11
                    \/ prefixLen = 12
                    \/ prefixLen > 12
                    \/ prefixLen = 13
                    \/ prefixLen > 13
                    \/ prefixLen = 14
                    \/ prefixLen > 14
                    \/ prefixLen = 15
                    \/ prefixLen > 15
                    \/ prefixLen = 16
                    \/ prefixLen > 16
                    \/ prefixLen = 17
                    \/ prefixLen > 17
                    \/ prefixLen = 18
                    \/ prefixLen > 18
                    \/ prefixLen = 19
                    \/ prefixLen > 19
                    \/ prefixLen = 20
                    \/ prefixLen > 20
                    \/ prefixLen = 21
                    \/ prefixLen > 21
                    \/ prefixLen = 22
                    \/ prefixLen > 22
                    \/ prefixLen = 23
                    \/ prefixLen > 23
                    \/ prefixLen = 24
                    \/ prefixLen > 24
                    \/ prefixLen = 25
                    \/ prefixLen > 25
                    \/ prefixLen = 26
                    \/ prefixLen > 26
                    \/ prefixLen = 27
                    \/ prefixLen > 27
                    \/ prefixLen = 28
                    \/ prefixLen > 28
                    \/ prefixLen = 29
                    \/ prefixLen > 29
                    \/ prefixLen = 30
                    \/ prefixLen > 30
                    \/ prefixLen = 31
                    \/ prefixLen > 31
                    \/ prefixLen = 32
                    \/ prefixLen > 32
                    \/ prefixLen = 33
                    \/ prefixLen > 33
                    \/ prefixLen = 34
                    \/ prefixLen > 34
                    \/ prefixLen = 35
                    \/ prefixLen > 35
                    \/ prefixLen = 36
                    \/ prefixLen > 36
                    \/ prefixLen = 37
                    \/ prefixLen > 37
                    \/ prefixLen = 38
                    \/ prefixLen > 38
                    \/ prefixLen = 39
                    \/ prefixLen > 39
                    \/ prefixLen = 40
                    \/ prefixLen > 40
                    \/ prefixLen = 41
                    \/ prefixLen > 41
                    \/ prefixLen = 42
                    \/ prefixLen > 42
                    \/ prefixLen = 43
                    \/ prefixLen > 43
                    \/ prefixLen = 44
                    \/ prefixLen > 44
                    \/ prefixLen = 45
                    \/ prefixLen > 45
                    \/ prefixLen = 46
                    \/ prefixLen > 46
                    \/ prefixLen = 47
                    \/ prefixLen > 47
                    \/ prefixLen = 48
                    \/ prefixLen > 48
                    \/ prefixLen = 49
                    \/ prefixLen > 49
                    \/ prefixLen = 50
                    \/ prefixLen > 50
                    \/ prefixLen = 51
                    \/ prefixLen > 51
                    \/ prefixLen = 52
                    \/ prefixLen > 52
                    \/ prefixLen = 53
                    \/ prefixLen > 53
                    \/ prefixLen = 54
                    \/ prefixLen > 54
                    \/ prefixLen = 55
                    \/ prefixLen > 55
                    \/ prefixLen = 56
                    \/ prefixLen > 56
                    \/ prefixLen = 57
                    \/ prefixLen > 57
                    \/ prefixLen = 58
                    \/ prefixLen > 58
                    \/ prefixLen = 59
                    \/ prefixLen > 59
                    \/ prefixLen = 60
                    \/ prefixLen > 60
                    \/ prefixLen = 61
                    \/ prefixLen > 61
                    \/ prefixLen = 62
                    \/ prefixLen > 62
                    \/ prefixLen = 63
                    \/ prefixLen > 63
                    \/ prefixLen = 64
                    \/ prefixLen > 64
                    \/ prefixLen = 65
                    \/ prefixLen > 65
                    \/ prefixLen = 66
                    \/ prefixLen > 66
                    \/ prefixLen = 67
                    \/ prefixLen > 67
                    \/ prefixLen = 68
                    \/ prefixLen > 68
                    \/ prefixLen = 69
                    \/ prefixLen > 69
                    \/ prefixLen = 70
                    \/ prefixLen > 70
                    \/ prefixLen = 71
                    \/ prefixLen > 71
                    \/ prefixLen = 72
                    \/ prefixLen > 72
                    \/ prefixLen = 73
                    \/ prefixLen > 73
                    \/ prefixLen = 74
                    \/ prefixLen > 74
                    \/ prefixLen = 75
                    \/ prefixLen > 75
                    \/ prefixLen = 76
                    \/ prefixLen > 76
                    \/ prefixLen = 77
                    \/ prefixLen > 77
                    \/ prefixLen = 78
                    \/ prefixLen > 78
                    \/ prefixLen = 79
                    \/ prefixLen > 79
                    \/ prefixLen = 80
                    \/ prefixLen > 80
                    \/ prefixLen = 81
                    \/ prefixLen > 81
                    \/ prefixLen = 82
                    \/ prefixLen > 82
                    \/ prefixLen = 83
                    \/ prefixLen > 83
                    \/ prefixLen = 84
                    \/ prefixLen > 84
                    \/ prefixLen = 85
                    \/ prefixLen > 85
                    \/ prefixLen = 86
                    \/ prefixLen > 86
                    \/ prefixLen = 87
                    \/ prefixLen > 87
                    \/ prefixLen = 88
                    \/ prefixLen > 88
                    \/ prefixLen = 89
                    \/ prefixLen > 89
                    \/ prefixLen = 90
                    \/ prefixLen > 90
                    \/ prefixLen = 91
                    \/ prefixLen > 91
                    \/ prefixLen = 92
                    \/ prefixLen > 92
                    \/ prefixLen = 93
                    \/ prefixLen > 93
                    \/ prefixLen = 94
                    \/ prefixLen > 94
                    \/ prefixLen = 95
                    \/ prefixLen > 95
                    \/ prefixLen = 96
                    \/ prefixLen > 96
                    \/ prefixLen = 97
                    \/ prefixLen > 97
                    \/ prefixLen = 98
                    \/ prefixLen > 98
                    \/ prefixLen = 99
                    \/ prefixLen > 99
                    \/ prefixLen = 100
                    \/ prefixLen > 100
                    \/ prefixLen = 101
                    \/ prefixLen > 101
                    \/ prefixLen = 102
                    \/ prefixLen > 102
                    \/ prefixLen = 103
                    \/ prefixLen > 103
                    \/ prefixLen = 104
                    \/ prefixLen > 104
                    \/ prefixLen = 105
                    \/ prefixLen > 105
                    \/ prefixLen = 106
                    \/ prefixLen > 106
                    \/ prefixLen = 107
                    \/ prefixLen > 107
                    \/ prefixLen = 108
                    \/ prefixLen > 108
                    \/ prefixLen = 109
                    \/ prefixLen > 109
                    \/ prefixLen = 110
                    \/ prefixLen > 110
                    \/ prefixLen = 111
                    \/ prefixLen > 111
                    \/ prefixLen = 112
                    \/ prefixLen > 112
                    \/ prefixLen = 113
                    \/ prefixLen > 113
                    \/ prefixLen = 114
                    \/ prefixLen > 114
                    \/ prefixLen = 115
                    \/ prefixLen > 115
                    \/ prefixLen = 116
                    \/ prefixLen > 116
                    \/ prefixLen = 117
                    \/ prefixLen > 117
                    \/ prefixLen = 118
                    \/ prefixLen > 118
                    \/ prefixLen = 119
                    \/ prefixLen > 119
                    \/ prefixLen = 120
                    \/ prefixLen > 120
                    \/ prefixLen = 121
                    \/ prefixLen > 121
                    \/ prefixLen = 122
                    \/ prefixLen > 122
                    \/ prefixLen = 123
                    \/ prefixLen > 123
                    \/ prefixLen = 124
                    \/ prefixLen > 124
                    \/ prefixLen = 125
                    \/ prefixLen > 125
                    \/ prefixLen = 126
                    \/ prefixLen > 126
                    \/ prefixLen = 127
                    \/ prefixLen > 127
                    \/ prefixLen = 128
                    \/ prefixLen > 128
                    \/ prefixLen = 129
                    \/ prefixLen > 129
                    \/ prefixLen = 130
                    \/ prefixLen > 130
                    \/ prefixLen = 131
                    \/ prefixLen > 131
                    \/ prefixLen = 132
                    \/ prefixLen > 132
                    \/ prefixLen = 133
                    \/ prefixLen > 133
                    \/ prefixLen = 134
                    \/ prefixLen > 134
                    \/ prefixLen = 135
                    \/ prefixLen > 135
                    \/ prefixLen = 136
                    \/ prefixLen > 136
                    \/ prefixLen = 137
                    \/ prefixLen > 137
                    \/ prefixLen = 138
                    \/ prefixLen > 138
                    \/ prefixLen = 139
                    \/ prefixLen > 139
                    \/ prefixLen = 140
                    \/ prefixLen > 140
                    \/ prefixLen = 141
                    \/ prefixLen > 141
                    \/ prefixLen = 142
                    \/ prefixLen > 142
                    \/ prefixLen = 143
                    \/ prefixLen > 143
                    \/ prefixLen = 144
                    \/ prefixLen > 144
                    \/ prefixLen = 145
                    \/ prefixLen > 145
                    \/ prefixLen = 146
                    \/ prefixLen > 146
                    \/ prefixLen = 147
                    \/ prefixLen > 147
                    \/ prefixLen = 148
                    \/ prefixLen > 148
                    \/ prefixLen = 149
                    \/ prefixLen > 149
                    \/ prefixLen = 150
                    \/ prefixLen > 150
                    \/ prefixLen = 151
                    \/ prefixLen > 151
                    \/ prefixLen = 152
                    \/ prefixLen > 152
                    \/ prefixLen = 153
                    \/ prefixLen > 153
                    \/ prefixLen = 154
                    \/ prefixLen > 154
                    \/ prefixLen = 155
                    \/ prefixLen > 155
                    \/ prefixLen = 156
                    \/ prefixLen > 156
                    \/ prefixLen = 157
                    \/ prefixLen > 157
                    \/ prefixLen = 158
                    \/ prefixLen > 158
                    \/ prefixLen = 159
                    \/ prefixLen > 159
                    \/ prefixLen = 160
                    \/ prefixLen > 160
                    \/ prefixLen = 161
                    \/ prefixLen > 161
                    \/ prefixLen = 162
                    \/ prefixLen > 162
                    \/ prefixLen = 163
                    \/ prefixLen > 163
                    \/ prefixLen = 164
                    \/ prefixLen > 164
                    \/ prefixLen = 165
                    \/ prefixLen > 165
                    \/ prefixLen = 166
                    \/ prefixLen > 166
                    \/ prefixLen = 167
                    \/ prefixLen > 167
                    \/ prefixLen = 168
                    \/ prefixLen > 168
                    \/ prefixLen = 169
                    \/ prefixLen > 169
                    \/ prefixLen = 170
                    \/ prefixLen > 170
                    \/ prefixLen = 171
                    \/ prefixLen > 171
                    \/ prefixLen = 172
                    \/ prefixLen > 172
                    \/ prefixLen = 173
                    \/ prefixLen > 173
                    \/ prefixLen = 174
                    \/ prefixLen > 174
                    \/ prefixLen = 175
                    \/ prefixLen > 175
                    \/ prefixLen = 176
                    \/ prefixLen > 176
                    \/ prefixLen = 177
                    \/ prefixLen > 177
                    \/ prefixLen = 178
                    \/ prefixLen > 178
                    \/ prefixLen = 179
                    \/ prefixLen > 179
                    \/ prefixLen = 180
                    \/ prefixLen > 180
                    \/ prefixLen = 181
                    \/ prefixLen > 181
                    \/ prefixLen = 182
                    \/ prefixLen > 182
                    \/ prefixLen = 183
                    \/ prefixLen > 183
                    \/ prefixLen = 184
                    \/ prefixLen > 184
                    \/ prefixLen = 185
                    \/ prefixLen > 185
                    \/ prefixLen = 186
                    \/ prefixLen > 186
                    \/ prefixLen = 187
                    \/ prefixLen > 187
                    \/ prefixLen = 188
                    \/ prefixLen > 188
                    \/ prefixLen = 189
                    \/ prefixLen > 189
                    \/ prefixLen = 190
                    \/ prefixLen > 190
                    \/ prefixLen = 191
                    \/ prefixLen > 191
                    \/ prefixLen = 192
                    \/ prefixLen > 192
                    \/ prefixLen = 193
                    \/ prefixLen > 193
                    \/ prefixLen = 194
                    \/ prefixLen > 194
                    \/ prefixLen = 195
                    \/ prefixLen > 195
                    \/ prefixLen = 196
                    \/ prefixLen > 196
                    \/ prefixLen = 197
                    \/ prefixLen > 197
                    \/ prefixLen = 198
                    \/ prefixLen > 198
                    \/ prefixLen = 199
                    \/ prefixLen > 199
                    \/ prefixLen = 200
                    \/ prefixLen > 200
                    \/ prefixLen = 201
                    \/ prefixLen > 201
                    \/ prefixLen = 202
                    \/ prefixLen > 202
                    \/ prefixLen = 203
                    \/ prefixLen > 203
                    \/ prefixLen = 204
                    \/ prefixLen > 204
                    \/ prefixLen = 205
                    \/ prefixLen > 205
                    \/ prefixLen = 206
                    \/ prefixLen > 206
                    \/ prefixLen = 207
                    \/ prefixLen > 207
                    \/ prefixLen = 208
                    \/ prefixLen > 208
                    \/ prefixLen = 209
                    \/ prefixLen > 209
                    \/ prefixLen = 210
                    \/ prefixLen > 210
                    \/ prefixLen = 211
                    \/ prefixLen > 211
                    \/ prefixLen = 212
                    \/ prefixLen > 212
                    \/ prefixLen = 213
                    \/ prefixLen > 213
                    \/ prefixLen = 214
                    \/ prefixLen > 214
                    \/ prefixLen = 215
                    \/ prefixLen > 215
                    \/ prefixLen = 216
                    \/ prefixLen > 216
                    \/ prefixLen = 217
                    \/ prefixLen > 217
                    \/ prefixLen = 218
                    \/ prefixLen > 218
                    \/ prefixLen = 219
                    \/ prefixLen > 219
                    \/ prefixLen = 220
                    \/ prefixLen > 220
                    \/ prefixLen = 221
                    \/ prefixLen > 221
                    \/ prefixLen = 222
                    \/ prefixLen > 222
                    \/ prefixLen = 223
                    \/ prefixLen > 223
                    \/ prefixLen = 224
                    \/ prefixLen > 224
                    \/ prefixLen = 225
                    \/ prefixLen > 225
                    \/ prefixLen = 226
                    \/ prefixLen > 226
                    \/ prefixLen = 227
                    \/ prefixLen > 227
                    \/ prefixLen = 228
                    \/ prefixLen > 228
                    \/ prefixLen = 229
                    \/ prefixLen > 229
                    \/ prefixLen = 230
                    \/ prefixLen > 230
                    \/ prefixLen = 231
                    \/ prefixLen > 231
                    \/ prefixLen = 232
                    \/ prefixLen > 232
                    \/ prefixLen = 233
                    \/ prefixLen > 233
                    \/ prefixLen = 234
                    \/ prefixLen > 234
                    \/ prefixLen = 235
                    \/ prefixLen > 235
                    \/ prefixLen = 236
                    \/ prefixLen > 236
                    \/ prefixLen = 237
                    \/ prefixLen > 237
                    \/ prefixLen = 238
                    \/ prefixLen > 238
                    \/ prefixLen = 239
                    \/ prefixLen > 239
                    \/ prefixLen = 240
                    \/ prefixLen > 240
                    \/ prefixLen = 241
                    \/ prefixLen > 241
                    \/ prefixLen = 242
                    \/ prefixLen > 242
                    \/ prefixLen = 243
                    \/ prefixLen > 243
                    \/ prefixLen = 244
                    \/ prefixLen > 244
                    \/ prefixLen = 245
                    \/ prefixLen > 245
                    \/ prefixLen = 246
                    \/ prefixLen > 246
                    \/ prefixLen = 247
                    \/ prefixLen > 247
                    \/ prefixLen = 248
                    \/ prefixLen > 248
                    \/ prefixLen = 249
                    \/ prefixLen > 249
                    \/ prefixLen = 250
                    \/ prefixLen > 250
                    \/ prefixLen = 251
                    \/ prefixLen > 251
                    \/ prefixLen = 252
                    \/ prefixLen > 252
                    \/ prefixLen = 253
                    \/ prefixLen > 253
                    \/ prefixLen = 254
                    \/ prefixLen > 254
                    \/ prefixLen = 255
                    \/ prefixLen > 255
                    \/ prefixLen = 256
                    \/ prefixLen > 256
                    \/ prefixLen = 257
                    \/ prefixLen > 257
                    \/ prefixLen = 258
                    \/ prefixLen > 258
                    \/ prefixLen = 259
                    \/ prefixLen > 259
                    \/ prefixLen = 260
                    \/ prefixLen > 260
                    \/ prefixLen = 261
                    \/ prefixLen > 261
                    \/ prefixLen = 262
                    \/ prefixLen > 262
                    \/ prefixLen = 263
                    \/ prefixLen > 263
                    \/ prefixLen = 264
                    \/ prefixLen > 264
                    \/ prefixLen = 265
                    \/ prefixLen > 265
                    \/ prefixLen = 266
                    \/ prefixLen > 266
                    \/ prefixLen = 267
                    \/ prefixLen > 267
                    \/ prefixLen = 268
                    \/ prefixLen > 268
                    \/ prefixLen = 269
                    \/ prefixLen > 269
                    \/ prefixLen = 270
                    \/ prefixLen > 270
                    \/ prefixLen = 271
                    \/ prefixLen > 271
                    \/ prefixLen = 272
                    \/ prefixLen > 272
                    \/ prefixLen = 273
                    \/ prefixLen > 273
                    \/ prefixLen = 274
                    \/ prefixLen > 274
                    \/ prefixLen = 275
                    \/ prefixLen > 275
                    \/ prefixLen = 276
                    \/ prefixLen > 276
                    \/ prefixLen = 277
                    \/ prefixLen > 277
                    \/ prefixLen = 278
                    \/ prefixLen > 278
                    \/ prefixLen = 279
                    \/ prefixLen > 279
                    \/ prefixLen = 280
                    \/ prefixLen > 280
                    \/ prefixLen = 281
                    \/ prefixLen > 281
                    \/ prefixLen = 282
                    \/ prefixLen > 282
                    \/ prefixLen = 283
                    \/ prefixLen > 283
                    \/ prefixLen = 284
                    \/ prefixLen > 284
                    \/ prefixLen = 285
                    \/ prefixLen > 285
                    \/ prefixLen = 286
                    \/ prefixLen > 286
                    \/ prefixLen = 287
                    \/ prefixLen > 287
                    \/ prefixLen = 288
                    \/ prefixLen > 288
                    \/ prefixLen = 289
                    \/ prefixLen > 289
                    \/ prefixLen = 290
                    \/ prefixLen > 290
                    \/ prefixLen = 291
                    \/ prefixLen > 291
                    \/ prefixLen = 292
                    \/ prefixLen > 292
                    \/ prefixLen = 293
                    \/ prefixLen > 293
                    \/ prefixLen = 294
                    \/ prefixLen > 294
                    \/ prefixLen = 295
                    \/ prefixLen > 295
                    \/ prefixLen = 296
                    \/ prefixLen > 296
                    \/ prefixLen = 297
                    \/ prefixLen > 297
                    \/ prefixLen = 298
                    \/ prefixLen > 298
                    \/ prefixLen = 299
                    \/ prefixLen > 299
                    \/ prefixLen = 300
                    \/ prefixLen > 300
                    \/ prefixLen = 301
                    \/ prefixLen > 301
                    \/ prefixLen = 302
                    \/ prefixLen > 302
                    \/ prefixLen = 303
                    \/ prefixLen > 303
                    \/ prefixLen = 304
                    \/ prefixLen > 304
                    \/ prefixLen = 305
                    \/ prefixLen > 305
                    \/ prefixLen = 306
                    \/ prefixLen > 306
                    \/ prefixLen = 307
                    \/ prefixLen > 307
                    \/ prefixLen = 308
                    \/ prefixLen > 308
                    \/ prefixLen = 309
                    \/ prefixLen > 309
                    \/ prefixLen = 310
                    \/ prefixLen > 310
                    \/ prefixLen = 311
                    \/ prefixLen > 311
                    \/ prefixLen = 312
                    \/ prefixLen > 312
                    \/ prefixLen = 313
                    \/ prefixLen > 313
                    \/ prefixLen = 314
                    \/ prefixLen > 314
                    \/ prefixLen = 315
                    \/ prefixLen > 315
                    \/ prefixLen = 316
                    \/ prefixLen > 316
                    \/ prefixLen = 317
                    \/ prefixLen > 317
                    \/ prefixLen = 318
                    \/ prefixLen > 318
                    \/ prefixLen = 319
                    \/ prefixLen > 319
                    \/ prefixLen = 320
                    \/ prefixLen > 320
                    \/ prefixLen = 321
                    \/ prefixLen > 321
                    \/ prefixLen = 322
                    \/ prefixLen > 322
                    \/ prefixLen
====